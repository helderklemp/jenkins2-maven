stage name: 'build', concurrency: 1

node {
    mvn "clean install -DskipTests"
}

stage name: 'test', concurrency: 3

node {
    mvn "-B test"
}

stage 'approve'
timeout(time: 1, unit: 'DAYS') {
    input message: 'Do you want to deploy?'
}
stage name: 'deploy', concurrency: 1
node {
    docker.image('maven:3.3.3-jdk-8').inside {
        // get the codez
        stage 'Checkout'
        git url: 'https://github.com/helderklemp/jenkins2-maven.git'
        stage 'Build'
        // Run the build
        sh "./mvnw clean install"
    }

}


def mvn(args) {
    sh "${tool 'm3'}/bin/mvn ${args}"
}

